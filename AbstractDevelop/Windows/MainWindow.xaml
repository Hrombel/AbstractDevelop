<Window
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        
        xmlns:local="clr-namespace:AbstractDevelop"
        
        xmlns:lang="http://gu.se/Localization"
        xmlns:p="clr-namespace:AbstractDevelop.Properties"
        
        x:Name="window" x:Class="AbstractDevelop.MainWindow"
        mc:Ignorable="d"
        
        Tag="{DynamicResource appIcon}"
     
        Title="AbstractDevelop (RISC R8 Engine)" 
        MinWidth="400" MinHeight="300" Width="600" Height="450"
        DataContext="{Binding Machine, RelativeSource={RelativeSource Self}}">
    <Window.Icon>
        <DrawingImage Drawing="{Binding Tag.Drawing,
            RelativeSource={RelativeSource AncestorType=Window}}"/>
    </Window.Icon>

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/AbstractDevelop;component/Resources/Graphics.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <local:DebugEntryTypeConverter x:Key="DebugEntryTypeConverter"/>
            <local:FormatConverter x:Key="FormatConverter"/>

            <Style TargetType="{x:Type GroupBox}">
                <Setter Property="Margin" Value="4, 0"/>
            </Style>

            <Style TargetType="{x:Type GridSplitter}">
                <Setter Property="Background" Value="Transparent"/>
            </Style>
            <DataTemplate x:Key="MemoryTemplate">
                <DataTemplate.Resources>
                    <Style TargetType="TextBox">
                        <Style.Setters>
                            <Setter Property="Background" Value="{x:Null}"/>
                            <Setter Property="BorderBrush" Value="{x:Null}"/>
                            <Setter Property="Foreground" Value="AntiqueWhite"/>
                            <Setter Property="CaretBrush" Value="AntiqueWhite"/>
                            <Setter Property="HorizontalAlignment" Value="Center"/>
                            
                            <Setter Property="IsReadOnly" Value="{Binding Machine.IsActive, ElementName=window, Mode=OneWay}"/>
                            <Setter Property="IsReadOnlyCaretVisible" Value="False"/>
                        </Style.Setters>
                    </Style>
                </DataTemplate.Resources>

                <StackPanel Orientation="Vertical" Margin="8" Width="150">
                    <Label Content="{Binding ID}" HorizontalAlignment="Right"/>
                    <Border BorderBrush="Black" BorderThickness="2" CornerRadius="5">
                        <Border.Background>
                            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                <GradientStop Color="Black" Offset="0"/>
                                <GradientStop Color="#FF1EC9E4" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>

                        <Border.Effect>
                            <DropShadowEffect/>
                        </Border.Effect>

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBox x:Name="formattedValue" Grid.Row="0" FontSize="24" Text="{Binding Value, FallbackValue=0, Converter={StaticResource FormatConverter}, ValidatesOnExceptions=True, ValidatesOnDataErrors=True}"/>
                            <TextBox x:Name="plainValue"     Grid.Row="1" FontSize="12" Text="{Binding Value, FallbackValue=0,  UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=True, ValidatesOnDataErrors=True}"/>
                        </Grid>
                    </Border>
                </StackPanel>
            </DataTemplate>
        </ResourceDictionary>
    </Window.Resources>

    <!--#region [I Want To Try Out The Regions]-->
    
    <Window.CommandBindings>
        <!-- Команды из меню "Файл" -->
        <CommandBinding Command="ApplicationCommands.New" Executed="NewCommandExecuted"/>
        <CommandBinding Command="ApplicationCommands.Open" Executed="OpenCommandExecuted"/>
        <CommandBinding Command="ApplicationCommands.Save" Executed="SaveCommandExecuted" CanExecute="SaveCanExecute"/>
        <CommandBinding Command="ApplicationCommands.SaveAs" Executed="SaveAsCommandExecuted" CanExecute="SaveAsCanExecute"/>
        <CommandBinding Command="{x:Static local:CustomCommands.FileClose}" Executed="FileCloseCommandExecuted" CanExecute="FileCloseCanExecute"/>
        <CommandBinding Command="ApplicationCommands.Close" Executed="CloseCommandExecuted"/>
        <!-- Команды из меню "Правка" -->
        <CommandBinding Command="ApplicationCommands.Undo" Executed="UndoCommandExecuted" CanExecute="UndoCanExecute"/>
        <CommandBinding Command="ApplicationCommands.Redo" Executed="RedoCommandExecuted" CanExecute="RedoCanExecute"/>
        <CommandBinding Command="ApplicationCommands.Copy" Executed="CopyCommandExecuted" CanExecute="CopyCanExecute"/>
        <CommandBinding Command="ApplicationCommands.Cut" Executed="CutCommandExecuted" CanExecute="CutCanExecute"/>
        <CommandBinding Command="ApplicationCommands.Paste" Executed="PasteCommandExecuted" CanExecute="PasteCanExecute"/>
        <!-- Команды из меню "Вид" -->
        <CommandBinding Command="{x:Static local:CustomCommands.CustomizeLayout}" Executed="CustomizeLayoutCommandExecuted"/>
        <CommandBinding Command="{x:Static local:CustomCommands.SelectFormat}" Executed="SelectFormatCommandExecuted"/>
        <CommandBinding Command="{x:Static local:CustomCommands.ClearAll}" Executed="ClearAllCommandExecuted"/>
        <CommandBinding Command="{x:Static local:CustomCommands.ClearDebug}" Executed="ClearDebugCommandExecuted" CanExecute="ClearDebugCanExecute"/>
        <!-- Команды из меню "Инструменты" -->
        <CommandBinding Command="{x:Static local:CustomCommands.DebugStartStop}" Executed="DebugStartStopCommandExecuted" CanExecute="DebugStartStopCanExecute"/>
        <CommandBinding Command="{x:Static local:CustomCommands.DebugStep}" Executed="DebugStepCommandExecuted" CanExecute="DebugStepCanExecute"/>
        <CommandBinding Command="{x:Static local:CustomCommands.DebugPause}" Executed="DebugPauseCommandExecuted" CanExecute="DebugPauseCanExecute"/>
        <CommandBinding Command="{x:Static local:CustomCommands.DebugBreakpoint}" Executed="DebugBreakpointCommandExecuted" CanExecute="DebugBreakpointCanExecute"/>
        
        <!-- Команды из меню "Справка" -->
        <CommandBinding Command="ApplicationCommands.Help" Executed="HelpCommandExecuted"/>
    </Window.CommandBindings>

    <!--#endregion-->
    
    <Grid x:Name="mainGrid">
        <Grid.RowDefinitions>
            <RowDefinition x:Name="menuRow" Height="Auto"/>
            <RowDefinition x:Name="memoryRow"/>
            <RowDefinition x:Name="splitterRow1" Height="Auto"/>
            <RowDefinition x:Name="editorRow"/>
            <RowDefinition x:Name="splitterRow2" Height="Auto"/>
            <RowDefinition x:Name="debugRow"/>
        </Grid.RowDefinitions>

        <!-- Главное меню -->
        <StackPanel Grid.Row="0">
            <Menu x:Name="mainMenu">
                <Menu.Resources>
                    <Style TargetType="MenuItem">
                        <Style.Setters>
                       
                        </Style.Setters>
                    </Style>
                </Menu.Resources>
                <MenuItem Header="{lang:Static p:Menu.FileMenu}">
                    <MenuItem Header="{lang:Static p:Menu.FileNew}" Command="ApplicationCommands.New"/>
                    <Separator/>

                    <MenuItem Header="{lang:Static p:Menu.FileOpen}" Command="ApplicationCommands.Open" />
                    <MenuItem Header="{lang:Static p:Menu.FileSave}" Command="ApplicationCommands.Save" />
                    <MenuItem Header="{lang:Static p:Menu.FileSaveAs}" Command="ApplicationCommands.SaveAs"/>
                    <Separator/>

                    <MenuItem Header="{lang:Static p:Menu.FileClose}" Command="{x:Static local:CustomCommands.FileClose}"/>
                    <MenuItem Header="{lang:Static p:Menu.FileExit}" Command="ApplicationCommands.Close"/>
                </MenuItem>
                <MenuItem Header="{lang:Static p:Menu.Edit}">
                    <MenuItem Header="{lang:Static p:Menu.EditUndo}" Command="ApplicationCommands.Undo"/>
                    <MenuItem Header="{lang:Static p:Menu.EditRedo}" Command="ApplicationCommands.Redo"/>
                    <Separator/>

                    <MenuItem Header="{lang:Static p:Menu.EditCopy}" Command="ApplicationCommands.Copy"/>
                    <MenuItem Header="{lang:Static p:Menu.EditCut}" Command="ApplicationCommands.Cut"/>
                    <MenuItem Header="{lang:Static p:Menu.EditPaste}" Command="ApplicationCommands.Paste"/>
                    <Separator/>

                    <MenuItem Header="{lang:Static p:Menu.ClearDebug}" Command="{x:Static local:CustomCommands.ClearDebug}"/>
                    <MenuItem Header="{lang:Static p:Menu.ClearAll}" Command="{x:Static local:CustomCommands.ClearAll}"/>
                </MenuItem>
                <MenuItem Header="{lang:Static p:Menu.View}">
                    <MenuItem Header="{lang:Static p:Menu.NumberFormat}">
                        <RadioButton x:Name="binaryFormat" Content="{lang:Static p:Menu.ViewBinary}" Command="{x:Static local:CustomCommands.SelectFormat}"/>
                        <RadioButton x:Name="octalFormat" Content="{lang:Static p:Menu.ViewOctal}" Command="{x:Static local:CustomCommands.SelectFormat}"/>
                        <RadioButton x:Name="hexFormat" Content="{lang:Static p:Menu.ViewHex}" Command="{x:Static local:CustomCommands.SelectFormat}"/>
                        <MenuItem x:Name="formatShowPrefix" Header="{lang:Static p:Menu.ViewShowPrefix}" Click="formatShowPrefix_Click" IsCheckable="True"/>
                    </MenuItem>

                    <Separator/>

                    <MenuItem x:Name="memEditorSetting" Header="{lang:Static p:Menu.ShowMemoryEditor}" IsCheckable="True" Command="{x:Static local:CustomCommands.CustomizeLayout}" IsChecked="True"/>
                    <MenuItem x:Name="codeEditorSetting" Header="{lang:Static p:Menu.ShowCodeEditor}" IsCheckable="True"  Command="{x:Static local:CustomCommands.CustomizeLayout}" IsChecked="True"/>
                    <MenuItem x:Name="regEditorSetting"  Header="{lang:Static p:Menu.ShowRegisterEditor}" IsCheckable="True"  Command="{x:Static local:CustomCommands.CustomizeLayout}" IsChecked="True"/>
                    <MenuItem x:Name="outputSetting"  Header="{lang:Static p:Menu.ShowDebugOutput}" IsCheckable="True"  Command="{x:Static local:CustomCommands.CustomizeLayout}" IsChecked="True"/>
                </MenuItem>
                <MenuItem Header="{lang:Static p:Menu.Tools}">
                    <MenuItem Header="{lang:Static p:Menu.Debug}">
                        <MenuItem x:Name="menuDebugStart" Header="{lang:Static p:Menu.DebugStart}"  Command="{x:Static local:CustomCommands.DebugStartStop}"/>
                        <MenuItem x:Name="menuDebugStop" Header="{lang:Static p:Menu.DebugStop}" Click="DebugCommandStop"/>
                        <MenuItem Header="{lang:Static p:Menu.DebugStep}" Command="{x:Static local:CustomCommands.DebugStep}"/>
                        <MenuItem Header="{lang:Static p:Menu.DebugPause}" Command="{x:Static local:CustomCommands.DebugPause}"/>
                        <MenuItem Header="{lang:Static p:Menu.DebugBreakpoint}" Command="{x:Static local:CustomCommands.DebugBreakpoint}"/>
                    </MenuItem>

                    <Separator/>

                    <MenuItem Header="{lang:Static p:Menu.ToolsSchema}" Click="OpenSchemaMenuCommand"/>
                    <MenuItem Header="{lang:Static p:Menu.ToolsTesting}" Click="OpenTestSystemMenuCommand"/>

                    <Separator/>

                    <MenuItem Header="{lang:Static p:Menu.Settings}" Click="SettingsCommandExecuted"/>
                </MenuItem>
                <MenuItem Header="{lang:Static p:Menu.Help}">
                    <MenuItem Header="{lang:Static p:Menu.HelpContent}" Command="ApplicationCommands.Help"/>
                    <MenuItem Header="{lang:Static p:Menu.HelpSamples}" Click="OpenSamplesMenuCommand"/>
                    <Separator/>

                    <MenuItem Header="{lang:Static p:Menu.HelpAbout}" Click="OpenHelpAboutMenuCommand" />
                </MenuItem>
            </Menu>
            <ToolBarTray IsLocked="True">
                <ToolBarTray.Resources>
                    <Style x:Key="toolButton" TargetType="Button">
                        <Style.Setters>
                            <Setter Property="Width" Value="40"/>
                            <Setter Property="Height" Value="40"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type Button}">
                                        <Border x:Name="buttonBorder" BorderBrush="Black" BorderThickness="0" Background="{TemplateBinding Background}">
                                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                    Margin="{TemplateBinding Padding}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" 
                    SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" RecognizesAccessKey="True"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="BorderThickness" Value="1" TargetName="buttonBorder" />
                                            </Trigger>
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter Property="Opacity" Value=".5" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style.Setters>
                    </Style>
                </ToolBarTray.Resources>
                <ToolBar>
                    <ToolBar.Background>
                        <LinearGradientBrush EndPoint="0,1" StartPoint="0,0">
                            <GradientStop Color="{DynamicResource {x:Static SystemColors.ControlColorKey}}" Offset="0"/>
                            <GradientStop Color="#FFEAE8E4" Offset="0.5"/>
                            <GradientStop Color="#FFD5D2CA" Offset="0.9"/>
                            <GradientStop Color="#FFDBD8D1" Offset="1"/>
                        </LinearGradientBrush>
                    </ToolBar.Background>
                    <Button Command="ApplicationCommands.New" Style="{DynamicResource toolButton}" Background="{DynamicResource documentnew}"/>
                    <Button Command="ApplicationCommands.Open" Style="{DynamicResource toolButton}" Background="{DynamicResource documentopen}"/>
                    <Button Command="ApplicationCommands.Save" Style="{DynamicResource toolButton}" Background="{DynamicResource documentsave}"/>
                    <Separator/>
                    <Button Command="ApplicationCommands.Undo" Style="{DynamicResource toolButton}" Background="{DynamicResource undo}"/>
                    <Button Command="ApplicationCommands.Redo" Style="{DynamicResource toolButton}" Background="{DynamicResource redo}"/>
                    <Separator/>
                    <Button Command="ApplicationCommands.Cut" Style="{DynamicResource toolButton}" Background="{DynamicResource editcut}"/>
                    <Button Command="ApplicationCommands.Copy" Style="{DynamicResource toolButton}" Background="{DynamicResource editcopy}"/>
                    <Button Command="ApplicationCommands.Paste" Style="{DynamicResource toolButton}" Background="{DynamicResource editpaste}"/>
                    <Separator/>
                    <Button x:Name="toolbarDebugStart" Command="{x:Static local:CustomCommands.DebugStartStop}" Style="{DynamicResource toolButton}" Background="{DynamicResource run}"/>
                    <Button x:Name="toolbarDebugStop" Click="DebugCommandStop"  Style="{DynamicResource toolButton}" Background="{DynamicResource stop}" Visibility="Collapsed"/>
                    <Button Command="{x:Static local:CustomCommands.DebugStep}" Style="{DynamicResource toolButton}" Background="{DynamicResource step}"/>
                    <Button Command="{x:Static local:CustomCommands.DebugPause}" Style="{DynamicResource toolButton}" Background="{DynamicResource pause}"/>
                    <Separator/>
                    <Button Click="SettingsCommandExecuted" Style="{DynamicResource toolButton}" Background="{DynamicResource settings}"/>
                    <Button Command="ApplicationCommands.Help" Style="{DynamicResource toolButton}" Background="{DynamicResource help}"/>
                </ToolBar>
            </ToolBarTray>
        </StackPanel>

        <GroupBox Header="{lang:Static p:Labels.MemoryEditor}" Grid.Row="1" >
            <ScrollViewer>
                <ItemsControl x:Name="memory" ItemTemplate="{DynamicResource MemoryTemplate}" ItemsSource="{Binding Memory}" HorizontalContentAlignment="Center">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <local:AlignableWrapPanel x:Name="memoryPanel" HorizontalAlignment="Center" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </ScrollViewer>
        </GroupBox>

        <GridSplitter Grid.Row="2" Height="3" HorizontalAlignment="Stretch" />

        <Grid x:Name="editorGrid" Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="codeColumn" Width="2*"/>
                <ColumnDefinition x:Name="registerColumn"/>
            </Grid.ColumnDefinitions>

            <GroupBox Header="{lang:Static p:Labels.CodeEditor}" Grid.Column="0">
                <local:CodeEditor x:Name="codeEditor" IsReadonly="{Binding IsActive}"/>
            </GroupBox>

            <GridSplitter Width="3"/>

            <GroupBox Header="{lang:Static p:Labels.Registers}" Grid.Column="1">
                <DataGrid x:Name="registers" AutoGenerateColumns="False" ItemsSource="{Binding Registers}">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="{lang:Static p:Labels.RegistersColumnID}" Binding="{Binding ID}" IsReadOnly="True"/>
                        <DataGridTextColumn x:Name="regstersFormat" Header="{p:Settings NumberFormat}" Width="2*" Binding="{Binding Value, Converter={StaticResource FormatConverter}}"/>
                        <DataGridTextColumn Header="{lang:Static p:Labels.RegistersColumnValue}" Width="*" Binding="{Binding Value}"/>
                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>
        </Grid>

        <GridSplitter Grid.Row="4" Height="3" HorizontalAlignment="Stretch" />

        <GroupBox x:Name="debugOutputGroup" Grid.Row="5" Header="{lang:Static p:Labels.Debug}">
            <DataGrid x:Name="debugOutputData" AutoGenerateColumns="False" EnableColumnVirtualization="True" GridLinesVisibility="Horizontal" IsReadOnly="True" ItemsSource="{Binding DebugMessages, ElementName=window}" >
                <DataGrid.Columns>
                    <DataGridTextColumn x:Name="typeColumn" Header="{lang:Static p:Labels.DebugType}" Binding="{Binding Type, Converter={StaticResource DebugEntryTypeConverter}}"/>
                    <DataGridTextColumn x:Name="lineColumn" Header="{lang:Static p:Labels.DebugLine}" Binding="{Binding Line}" />
                    <DataGridTextColumn x:Name="messageColumn" Header="{lang:Static p:Labels.DebugMessage}" Width="*" Binding="{Binding Content}"/>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>
    </Grid>
</Window>
